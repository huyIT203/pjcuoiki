<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thanh toán - VietShop</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <!-- Header will be loaded here -->
    <div id="header-container"></div>

    <!-- Breadcrumb -->
    <section class="breadcrumb-section bg-light py-3">
        <div class="container">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb mb-0">
                    <li class="breadcrumb-item"><a href="index.html">Trang chủ</a></li>
                    <li class="breadcrumb-item"><a href="cart.html">Giỏ hàng</a></li>
                    <li class="breadcrumb-item active" aria-current="page">Thanh toán</li>
                </ol>
            </nav>
        </div>
    </section>

    <!-- Checkout Section -->
    <section class="checkout-section py-5">
        <div class="container">
            <h2 class="section-title mb-4">Thanh toán</h2>
            
            <!-- Authentication Check -->
            <div id="authenticationCheck" class="d-none">
                <div class="alert alert-warning">
                    <h5><i class="fas fa-exclamation-triangle me-2"></i>Vui lòng đăng nhập để tiếp tục</h5>
                    <p>Bạn cần đăng nhập để hoàn tất quá trình thanh toán.</p>
                    <button id="checkoutLoginBtn" class="btn btn-primary">
                        <i class="fas fa-sign-in-alt me-2"></i>Đăng nhập
                    </button>
                </div>
            </div>
            
            <!-- Empty Cart Check -->
            <div id="emptyCartCheck" class="d-none">
                <div class="alert alert-warning">
                    <h5><i class="fas fa-shopping-cart me-2"></i>Giỏ hàng trống</h5>
                    <p>Bạn cần thêm sản phẩm vào giỏ hàng trước khi thanh toán.</p>
                    <a href="products.html" class="btn btn-primary">
                        <i class="fas fa-shopping-bag me-2"></i>Tiếp tục mua sắm
                    </a>
                </div>
            </div>
            
            <!-- Checkout Form -->
            <div id="checkoutForm" class="row">
                <!-- Shipping Information -->
                <div class="col-lg-8">
                    <div class="card shadow-sm mb-4">
                        <div class="card-header bg-white">
                            <h5 class="card-title mb-0">Thông tin giao hàng</h5>
                        </div>
                        <div class="card-body">
                            <form id="shippingForm">
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="fullName" class="form-label">Họ và tên</label>
                                        <input type="text" class="form-control" id="fullName" required>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="phone" class="form-label">Số điện thoại</label>
                                        <input type="tel" class="form-control" id="phone" required>
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="email" class="form-label">Email</label>
                                    <input type="email" class="form-control" id="email" required>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="address" class="form-label">Địa chỉ</label>
                                    <input type="text" class="form-control" id="address" required>
                                </div>
                                
                                <div class="row">
                                    <div class="col-md-5 mb-3">
                                        <label for="province" class="form-label">Tỉnh/Thành phố</label>
                                        <select class="form-select" id="province" required>
                                            <option value="">Chọn tỉnh/thành phố</option>
                                            <option value="HCM">Hồ Chí Minh</option>
                                            <option value="HN">Hà Nội</option>
                                            <option value="DN">Đà Nẵng</option>
                                            <!-- More options will be loaded dynamically -->
                                        </select>
                                    </div>
                                    <div class="col-md-4 mb-3">
                                        <label for="district" class="form-label">Quận/Huyện</label>
                                        <select class="form-select" id="district" required>
                                            <option value="">Chọn quận/huyện</option>
                                            <!-- Options will be loaded dynamically based on province -->
                                        </select>
                                    </div>
                                    <div class="col-md-3 mb-3">
                                        <label for="ward" class="form-label">Phường/Xã</label>
                                        <select class="form-select" id="ward" required>
                                            <option value="">Chọn phường/xã</option>
                                            <!-- Options will be loaded dynamically based on district -->
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="note" class="form-label">Ghi chú</label>
                                    <textarea class="form-control" id="note" rows="3" placeholder="Ghi chú về đơn hàng, ví dụ: thời gian hay chỉ dẫn địa điểm giao hàng chi tiết hơn."></textarea>
                                </div>
                            </form>
                        </div>
                    </div>
                    
                    <!-- Payment Method -->
                    <div class="card shadow-sm">
                        <div class="card-header bg-white">
                            <h5 class="card-title mb-0">Phương thức thanh toán</h5>
                        </div>
                        <div class="card-body">
                            <div class="form-check mb-3">
                                <input class="form-check-input" type="radio" name="paymentMethod" id="cod" value="cod" checked>
                                <label class="form-check-label" for="cod">
                                    <i class="fas fa-money-bill-wave me-2"></i>Thanh toán khi nhận hàng (COD)
                                </label>
                            </div>
                            <div class="form-check mb-3">
                                <input class="form-check-input" type="radio" name="paymentMethod" id="bank_transfer" value="bank_transfer">
                                <label class="form-check-label" for="bank_transfer">
                                    <i class="fas fa-university me-2"></i>Chuyển khoản ngân hàng
                                </label>
                                <div class="bank-info mt-2 ms-4 d-none" id="bankInfo">
                                    <div class="card bg-light">
                                        <div class="card-body">
                                            <p class="mb-1"><strong>Ngân hàng:</strong> Vietcombank</p>
                                            <p class="mb-1"><strong>Số tài khoản:</strong> 1234567890</p>
                                            <p class="mb-1"><strong>Chủ tài khoản:</strong> CÔNG TY TNHH VIETSHOP</p>
                                            <p class="mb-0"><strong>Nội dung:</strong> <span id="transferReference">[Mã đơn hàng]</span></p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="form-check mb-3 opacity-50">
                                <input class="form-check-input" type="radio" name="paymentMethod" id="momo" value="momo" disabled>
                                <label class="form-check-label" for="momo">
                                    <i class="fas fa-mobile-alt me-2"></i>Ví điện tử MoMo (Sắp ra mắt)
                                </label>
                            </div>
                            <div class="form-check opacity-50">
                                <input class="form-check-input" type="radio" name="paymentMethod" id="credit_card" value="credit_card" disabled>
                                <label class="form-check-label" for="credit_card">
                                    <i class="fas fa-credit-card me-2"></i>Thẻ tín dụng/Ghi nợ (Sắp ra mắt)
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Order Summary -->
                <div class="col-lg-4">
                    <div class="card shadow-sm mb-4 order-summary">
                        <div class="card-header bg-white">
                            <h5 class="card-title mb-0">Tóm tắt đơn hàng</h5>
                        </div>
                        <div class="card-body">
                            <div id="orderItemsContainer">
                                <div class="text-center py-3">
                                    <div class="spinner-border spinner-border-sm text-primary" role="status">
                                        <span class="visually-hidden">Đang tải...</span>
                                    </div>
                                    <span class="ms-2">Đang tải sản phẩm...</span>
                                </div>
                            </div>
                            
                            <hr>
                            
                            <div class="coupon-area mb-3">
                                <div class="input-group">
                                    <input type="text" class="form-control" id="couponCode" placeholder="Mã giảm giá">
                                    <button class="btn btn-outline-primary" type="button" id="applyCouponBtn">Áp dụng</button>
                                </div>
                            </div>
                            
                            <div class="order-totals">
                                <div class="d-flex justify-content-between mb-2">
                                    <span>Tạm tính:</span>
                                    <span id="subtotal">0đ</span>
                                </div>
                                <div class="d-flex justify-content-between mb-2">
                                    <span>Giảm giá:</span>
                                    <span id="discount">0đ</span>
                                </div>
                                <div class="d-flex justify-content-between mb-2">
                                    <span>Phí vận chuyển:</span>
                                    <span id="shipping">0đ</span>
                                    <small id="shipping-note" class="text-success"></small>
                                </div>
                                <hr>
                                <div class="d-flex justify-content-between mb-3">
                                    <strong>Tổng cộng:</strong>
                                    <strong class="text-primary" id="total">0đ</strong>
                                </div>
                                
                                <button type="button" class="btn btn-primary btn-lg w-100" id="placeOrderBtn">
                                    <i class="fas fa-check-circle me-2"></i>Đặt hàng
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Order Success Modal -->
    <div class="modal fade" id="orderSuccessModal" data-bs-backdrop="static" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-body text-center py-4">
                    <i class="fas fa-check-circle text-success fa-5x mb-3"></i>
                    <h4 class="mb-3">Đặt hàng thành công!</h4>
                    <p>Cảm ơn bạn đã mua hàng tại VietShop. Đơn hàng của bạn đã được đặt thành công.</p>
                    <p class="mb-0">Mã đơn hàng: <strong id="successOrderId">ORD123456</strong></p>
                    <p>Chúng tôi sẽ sớm liên hệ với bạn để xác nhận đơn hàng.</p>
                    <div class="mt-4">
                        <a href="orders.html" class="btn btn-primary me-2">Xem đơn hàng</a>
                        <a href="index.html" class="btn btn-outline-secondary">Tiếp tục mua sắm</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer will be loaded here -->
    <div id="footer-container"></div>

    <!-- Toast Notification -->
    <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 5">
        <div id="notificationToast" class="toast hide" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header">
                <strong class="me-auto">Thông báo</strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
            <div class="toast-body" id="toastMessage"></div>
        </div>
    </div>

    <!-- Scripts -->
    <script>
        // Define base API URL
        window.API_BASE_URL = 'http://localhost:5000/api';
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/template-loader.js"></script>
    <script src="js/checkout.js"></script>

    <script>
        // Load templates
        document.addEventListener('DOMContentLoaded', function() {
            loadTemplates().then(() => {
                console.log('Templates loaded successfully');
            }).catch(error => {
                console.error('Error loading templates:', error);
            });
        });
    </script>
</body>
</html> 