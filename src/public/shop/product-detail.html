<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Chi tiết sản phẩm - VietShop</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <!-- Header - sẽ được tải từ template -->
    <div id="header-container"></div>

    <!-- Product Detail -->
    <section class="product-detail py-5">
        <div class="container">
            <div id="productDetail">
                <!-- Product detail will be loaded dynamically -->
            </div>
            
            <!-- Related Products -->
            <div class="related-products mt-5">
                <h2 class="mb-4">Sản phẩm liên quan</h2>
                <div class="row" id="relatedProducts">
                    <!-- Related products will be loaded dynamically -->
                </div>
            </div>
        </div>
    </section>

    <!-- Newsletter -->
    <section class="newsletter py-5 bg-primary text-white">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-6">
                    <h3>Đăng ký nhận thông tin</h3>
                    <p>Nhận thông tin về sản phẩm mới và ưu đãi đặc biệt.</p>
                </div>
                <div class="col-md-6">
                    <form class="d-flex">
                        <input type="email" class="form-control me-2" placeholder="Nhập email của bạn">
                        <button type="submit" class="btn btn-light">Đăng ký</button>
                    </form>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer - sẽ được tải từ template -->
    <div id="footer-container"></div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
    // Định nghĩa API_BASE_URL trước khi import các file JS khác
    window.API_BASE_URL = 'http://localhost:5000/api';
    // Định nghĩa PRODUCTS_API_URL từ API_BASE_URL
    window.PRODUCTS_API_URL = window.API_BASE_URL;
    </script>
    <script src="js/template-loader.js"></script>
    <script src="js/main.js"></script>
    <script src="js/image-loader.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/auth-components.js"></script>
    <script src="js/products.js"></script>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        console.log('Product detail page loaded');
        
        // Tải các template
        loadTemplates().then(() => {
            console.log('Templates loaded successfully');
            
            // Kiểm tra biến API_BASE_URL
            if (!window.API_BASE_URL) {
                console.error('API_BASE_URL chưa được định nghĩa!');
                showAPIError();
                return;
            }
            
            try {
                // Khởi tạo trang chi tiết sản phẩm
                if (typeof initProductDetailPage === 'function') {
                    initProductDetailPage();
                } else {
                    console.error('Function initProductDetailPage is not defined');
                    showGeneralError('Function initProductDetailPage is not defined');
                }
            } catch (error) {
                console.error('Lỗi khi khởi tạo trang chi tiết sản phẩm:', error);
                showGeneralError(error.message);
            }
        }).catch(error => {
            console.error('Error loading templates:', error);
            showGeneralError('Không thể tải template. Vui lòng tải lại trang.');
        });
        
        // Thiết lập bắt lỗi toàn cục
        window.addEventListener('error', function(event) {
            console.error('Lỗi Javascript toàn cục:', event.message, 'tại', event.filename, 'dòng', event.lineno);
        });
    });
    
    function showAPIError() {
        document.getElementById('productDetail').innerHTML = `
            <div class="col-12">
                <div class="alert alert-danger">
                    <i class="fas fa-exclamation-circle me-2"></i>
                    <strong>Lỗi cấu hình API:</strong> API_BASE_URL chưa được định nghĩa.
                    <br>Vui lòng kiểm tra kết nối mạng hoặc cấu hình server.
                </div>
                <div class="text-center mt-4">
                    <a href="products.html" class="btn btn-primary">Xem tất cả sản phẩm</a>
                    <button class="btn btn-outline-primary ms-2" onclick="location.reload()">
                        <i class="fas fa-sync-alt me-1"></i> Tải lại trang
                    </button>
                </div>
            </div>
        `;
    }
    
    function showGeneralError(message) {
        document.getElementById('productDetail').innerHTML = `
            <div class="col-12">
                <div class="alert alert-danger">
                    <i class="fas fa-exclamation-circle me-2"></i>
                    <strong>Đã xảy ra lỗi:</strong> ${message || 'Không thể tải thông tin sản phẩm'}
                    <br>Vui lòng thử lại sau.
                </div>
                <div class="text-center mt-4">
                    <a href="products.html" class="btn btn-primary">Xem tất cả sản phẩm</a>
                    <button class="btn btn-outline-primary ms-2" onclick="location.reload()">
                        <i class="fas fa-sync-alt me-1"></i> Tải lại trang
                    </button>
                </div>
            </div>
        `;
    }
    </script>
</body>
</html> 